<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Retrospectivas Ágiles</title>
    <link rel="stylesheet" href="css/index.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="js/datos.js" defer></script>
</head>
<body>
<div class="container">
    <h1>Gestor de Retrospectivas Ágiles</h1>
    <p>Realiza un seguimiento sencillo de tus sprints.</p>

    <div>
        <button class="btn btn-primary" onclick="mostrarVista('nueva')">Nueva Retrospectiva</button>
        <button class="btn btn-secondary" onclick="mostrarVista('historial')">Historial</button>
        <button class="btn btn-info" onclick="mostrarVista('reporte')">Reporte</button>
        <button class="btn btn-success" onclick="mostrarVista('inicio')">Inicio</button>
    </div>

    <div id="inicio" class="vista">
        <h2>Inicio</h2>
        <p>Bienvenido a la herramienta de retrospectivas. Comienza creando una nueva o consulta las registradas.</p>
    </div>

    <div id="nueva" class="vista" style="display: none;">
        <h2>Crear Nueva Retrospectiva</h2>
        <form id="form-retrospectiva">
            <label for="nombre">Nombre del Sprint</label>
            <input type="text" id="nombre" name="nombre" placeholder="Ejemplo: Sprint 1" required>

            <label for="fecha_inicio">Fecha de Inicio</label>
            <input type="date" id="fecha_inicio" name="fecha_inicio" required>

            <label for="fecha_fin">Fecha de Fin</label>
            <input type="date" id="fecha_fin" name="fecha_fin" required>

            <button class="btn btn-primary" onclick="guardarRetrospectiva(event)">Guardar</button>
        </form>
    </div>

    <div id="historial" class="vista" style="display: none;">
        <h2>Historial de Retrospectivas</h2>
        <div id="lista-historial">
            <p>No se han registrado retrospectivas aún.</p>
        </div>
    </div>

    <div id="crear-retro-item" class="vista" style="display: none;">
        <h2>Añadir Comentario al Sprint</h2>
        <form id="form-retro-item" onsubmit="guardarRetrospectivacome(event)">
            <label for="sprint_id">Selecciona el Sprint</label>
            <select id="sprint_id" name="sprint_id" required>
                <option value="">-- Selecciona --</option>
                <!-- Se llena desde JS -->
            </select>

            <label for="categoria">Categoría</label>
            <select id="categoria" name="categoria" required>
                <option value="">-- Selecciona --</option>
                <option value="accion">Acción</option>
                <option value="logro">Logro</option>
                <option value="impedimento">Impedimento</option>
                <option value="comentario">Comentario</option>
                <option value="otro">Otro</option>
            </select>

            <div id="campos-extra" style="display: none;">
                <label for="descripcion">Descripción</label>
                <textarea id="descripcion" name="descripcion" required></textarea>

                <label>
                    <input type="checkbox" id="cumplida" name="cumplida">
                    Cumplida
                </label>

                <label for="fecha_revision">Fecha de Revisión (opcional)</label>
                <input type="date" id="fecha_revision" name="fecha_revision">

                <button type="submit" class="btn btn-primary">Guardar Comentario</button>
            </div>
        </form>
    </div>
</div>

<div id="reporte" class="vista" style="display: none;">
    <h2>Reporte de Comentarios por Retrospectiva</h2>
    <div id="reporte-comentarios">
        <p>Cargando comentarios...</p>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const data = await fetchSprints();
            const select = document.getElementById('sprint_id');
            data.forEach(sprint => {
                const option = document.createElement('option');
                option.value = sprint.id;
                option.textContent = sprint.nombre;
                select.appendChild(option);
            });
        } catch (e) {
            console.error("No se pudo cargar el listado de sprints.");
        }

        const categoriaSelect = document.getElementById('categoria');
        const camposExtra = document.getElementById('campos-extra');

        categoriaSelect.addEventListener('change', () => {
            if (categoriaSelect.value) {
                camposExtra.style.display = 'block';
            } else {
                camposExtra.style.display = 'none';
            }
        });
    });
</script>

</body>
</html>
